"use strict";(globalThis.webpackChunkportfolio_edu_lab=globalThis.webpackChunkportfolio_edu_lab||[]).push([[6820],{8453(e,s,n){n.d(s,{R:()=>l,x:()=>a});var i=n(6540);const r={},t=i.createContext(r);function l(e){const s=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(t.Provider,{value:s},e.children)}},9941(e,s,n){n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>a,default:()=>o,frontMatter:()=>l,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"edulab-synthesis-engine/software-architecture","title":"Software Architecture","description":"Documentation of the current software implementation.","source":"@site/docs/edulab-synthesis-engine/software-architecture.md","sourceDirName":"edulab-synthesis-engine","slug":"/edulab-synthesis-engine/software-architecture","permalink":"/portfolio_eduLAB/projects/edulab-synthesis-engine/software-architecture","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Software Architecture"},"sidebar":"projectsSidebar","previous":{"title":"Hardware Design","permalink":"/portfolio_eduLAB/projects/edulab-synthesis-engine/hardware-design"},"next":{"title":"Replication Status","permalink":"/portfolio_eduLAB/projects/edulab-synthesis-engine/build-guide"}}');var r=n(4848),t=n(8453);const l={sidebar_position:3,title:"Software Architecture"},a="Software Architecture \u2014 v3.8",c={},d=[{value:"1. What This Page Documents",id:"1-what-this-page-documents",level:2},{value:"2. Design Philosophy: Monolithic First",id:"2-design-philosophy-monolithic-first",level:2},{value:"3. System Overview",id:"3-system-overview",level:2},{value:"4. File Structure",id:"4-file-structure",level:2},{value:"5. The ONE Class: Potentiometer",id:"5-the-one-class-potentiometer",level:2},{value:"6. State Management",id:"6-state-management",level:2},{value:"6.1 UI State Machine",id:"61-ui-state-machine",level:3},{value:"6.2 Mute State",id:"62-mute-state",level:3},{value:"6.3 Waveform Modes",id:"63-waveform-modes",level:3},{value:"7. Interrupt Service Routine (ISR)",id:"7-interrupt-service-routine-isr",level:2},{value:"8. Main Loop Structure",id:"8-main-loop-structure",level:2},{value:"9. Timing Model",id:"9-timing-model",level:2},{value:"10. Audio Engine (PWM Generation)",id:"10-audio-engine-pwm-generation",level:2},{value:"11. Display Rendering",id:"11-display-rendering",level:2},{value:"12. Code Annotations",id:"12-code-annotations",level:2},{value:"Button State Machine",id:"button-state-machine",level:3},{value:"Race Condition Protection",id:"race-condition-protection",level:3},{value:"Display Throttling",id:"display-throttling",level:3},{value:"13. Known Software Issues",id:"13-known-software-issues",level:2},{value:"14. What&#39;s NOT Here",id:"14-whats-not-here",level:2},{value:"Architecture",id:"architecture",level:3},{value:"Audio",id:"audio",level:3},{value:"Optimization",id:"optimization",level:3},{value:"15. What This Architecture Taught Me",id:"15-what-this-architecture-taught-me",level:2},{value:"16. Next: v4.0 Software Refactor",id:"16-next-v40-software-refactor",level:2},{value:"17. Related Documentation",id:"17-related-documentation",level:2},{value:"Closing",id:"closing",level:2}];function h(e){const s={a:"a",admonition:"admonition",annotation:"annotation",blockquote:"blockquote",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",math:"math",mi:"mi",mn:"mn",mo:"mo",mrow:"mrow",msub:"msub",mtext:"mtext",p:"p",pre:"pre",semantics:"semantics",span:"span",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"software-architecture--v38",children:"Software Architecture \u2014 v3.8"})}),"\n",(0,r.jsxs)(s.blockquote,{children:["\n",(0,r.jsx)(s.p,{children:"Documentation of the current software implementation."}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"1-what-this-page-documents",children:"1. What This Page Documents"}),"\n",(0,r.jsxs)(s.p,{children:["This page describes the ",(0,r.jsx)(s.strong,{children:"v3.8 software architecture"})," as it exists now \u2014 not as planned, not idealized."]}),"\n",(0,r.jsxs)(s.p,{children:["This is a deliberately simple, single-file, procedural implementation. The goal is not modularity or scalability. The goal is understanding real-time embedded constraints, state machines, and interrupt-driven input ",(0,r.jsx)(s.strong,{children:"before"})," introducing OOP abstractions."]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"v3.8 is intentionally non-modular."})}),"\n",(0,r.jsx)(s.p,{children:"There is no class hierarchy. There is no HAL. There is no separate audio thread."}),"\n",(0,r.jsx)(s.p,{children:"These are not oversights \u2014 they are pedagogical choices."}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"2-design-philosophy-monolithic-first",children:"2. Design Philosophy: Monolithic First"}),"\n",(0,r.jsx)(s.p,{children:"Before building a multi-file OOP architecture, I wanted to understand:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"How state machines manage UI flow"}),"\n",(0,r.jsx)(s.li,{children:"How interrupts interact with main loop logic"}),"\n",(0,r.jsx)(s.li,{children:"How to prevent race conditions in embedded systems"}),"\n",(0,r.jsx)(s.li,{children:"What filtering is required for noisy ADC inputs"}),"\n",(0,r.jsx)(s.li,{children:"Why certain ESP32 peripheral calls must happen in specific order"}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"The entire firmware is ~450 lines in a single file."})}),"\n",(0,r.jsx)(s.p,{children:"This makes the control flow transparent. Every variable, every function, every dependency is visible in one place."}),"\n",(0,r.jsxs)(s.admonition,{title:"Why This Is NOT How Professionals Do It",type:"warning",children:[(0,r.jsx)(s.p,{children:"This architecture violates multiple professional best practices:"}),(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Monolithic file structure"}),"\n",(0,r.jsx)(s.li,{children:"Global state variables"}),"\n",(0,r.jsx)(s.li,{children:"Shared state between ISR and main loop (requires careful atomic access)"}),"\n",(0,r.jsx)(s.li,{children:"No separation of concerns"}),"\n",(0,r.jsx)(s.li,{children:"No hardware abstraction layer"}),"\n"]}),(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"This is intentional."})}),(0,r.jsx)(s.p,{children:"The goal is to expose real embedded constraints before abstraction hides them."}),(0,r.jsx)(s.p,{children:"Professional refactoring begins in v4.0."})]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"3-system-overview",children:"3. System Overview"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502   MAIN LOOP (~7.6 kHz, measured under typical load)     \u2502\r\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\r\n\u2502                                                          \u2502\r\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                      \u2502\r\n\u2502  \u2502   INPUT    \u2502   \u2502  UI STATE    \u2502                      \u2502\r\n\u2502  \u2502 PROCESSING \u2502\u2500\u2500\u25b6\u2502   MACHINE    \u2502                      \u2502\r\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                      \u2502\r\n\u2502       \u25b2                   \u2502                              \u2502\r\n\u2502       \u2502                   \u25bc                              \u2502\r\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                       \u2502\r\n\u2502  \u2502    ISR    \u2502   \u2502    AUDIO     \u2502                       \u2502\r\n\u2502  \u2502 (Encoder) \u2502   \u2502    ENGINE    \u2502                       \u2502\r\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                       \u2502\r\n\u2502                          \u2502                               \u2502\r\n\u2502                          \u25bc                               \u2502\r\n\u2502                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                        \u2502\r\n\u2502                  \u2502   DISPLAY    \u2502                        \u2502\r\n\u2502                  \u2502   RENDERER   \u2502                        \u2502\r\n\u2502                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                        \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Execution model:"})," Single-threaded with interrupt service routine (ISR)"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Data flow direction:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"ISR updates encoder position \u2192 Main loop consumes it\r\nNever the other way around\n"})}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"4-file-structure",children:"4. File Structure"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"src/\r\n\u2514\u2500\u2500 main.cpp  (ENTIRE PROJECT - ~450 lines)\r\n    \u251c\u2500\u2500 1. Hardware Configuration\r\n    \u251c\u2500\u2500 2. Potentiometer Class (EMA Filter)\r\n    \u251c\u2500\u2500 3. State Management (Global Variables)\r\n    \u251c\u2500\u2500 4. Interrupt Service Routine (Encoder)\r\n    \u251c\u2500\u2500 5. Helper Functions\r\n    \u251c\u2500\u2500 6. Graphics Functions\r\n    \u251c\u2500\u2500 7. setup()\r\n    \u2514\u2500\u2500 8. loop()\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Why single-file?"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"No build complexity"}),"\n",(0,r.jsx)(s.li,{children:"No header/implementation split confusion"}),"\n",(0,r.jsx)(s.li,{children:"Complete visibility of execution flow"}),"\n",(0,r.jsx)(s.li,{children:"Forces understanding of scope and lifetime"}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"What this is NOT:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"\u274c Not modular"}),"\n",(0,r.jsx)(s.li,{children:"\u274c Not reusable"}),"\n",(0,r.jsx)(s.li,{children:"\u274c Not scalable"}),"\n",(0,r.jsx)(s.li,{children:"\u274c Not professional architecture"}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"But it IS:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"\u2705 Readable"}),"\n",(0,r.jsx)(s.li,{children:"\u2705 Debuggable"}),"\n",(0,r.jsx)(s.li,{children:"\u2705 Educational"}),"\n",(0,r.jsx)(s.li,{children:"\u2705 Sufficient for learning"}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"5-the-one-class-potentiometer",children:"5. The ONE Class: Potentiometer"}),"\n",(0,r.jsx)(s.p,{children:"The only OOP structure in v3.8."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-cpp",children:"class Potentiometer {\r\n  private:\r\n    int pin;\r\n    float filteredValue;      // EMA accumulator\r\n    float alpha;              // Smoothing factor\r\n    int lastStableValue;      // Hysteresis state\r\n    int threshold;            // Change detection threshold\r\n    \r\n  public:\r\n    Potentiometer(int p, float a = 0.15, int th = 40);\r\n    void begin();\r\n    bool update();            // Returns true if value changed\r\n    int getValue();\r\n};\n"})}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Purpose:"})," Smooth noisy ADC readings"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Algorithm:"})," Exponential Moving Average (EMA) + Hysteresis"]}),"\n",(0,r.jsx)(s.span,{className:"katex-display",children:(0,r.jsxs)(s.span,{className:"katex",children:[(0,r.jsx)(s.span,{className:"katex-mathml",children:(0,r.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block",children:(0,r.jsxs)(s.semantics,{children:[(0,r.jsxs)(s.mrow,{children:[(0,r.jsxs)(s.msub,{children:[(0,r.jsx)(s.mi,{children:"V"}),(0,r.jsx)(s.mtext,{children:"filtered"})]}),(0,r.jsx)(s.mo,{children:"="}),(0,r.jsx)(s.mi,{children:"\u03b1"}),(0,r.jsx)(s.mo,{children:"\u22c5"}),(0,r.jsxs)(s.msub,{children:[(0,r.jsx)(s.mi,{children:"V"}),(0,r.jsx)(s.mtext,{children:"raw"})]}),(0,r.jsx)(s.mo,{children:"+"}),(0,r.jsx)(s.mo,{stretchy:"false",children:"("}),(0,r.jsx)(s.mn,{children:"1"}),(0,r.jsx)(s.mo,{children:"\u2212"}),(0,r.jsx)(s.mi,{children:"\u03b1"}),(0,r.jsx)(s.mo,{stretchy:"false",children:")"}),(0,r.jsx)(s.mo,{children:"\u22c5"}),(0,r.jsxs)(s.msub,{children:[(0,r.jsx)(s.mi,{children:"V"}),(0,r.jsx)(s.mtext,{children:"filtered"})]})]}),(0,r.jsx)(s.annotation,{encoding:"application/x-tex",children:"V_{\\text{filtered}} = \\alpha \\cdot V_{\\text{raw}} + (1 - \\alpha) \\cdot V_{\\text{filtered}}"})]})})}),(0,r.jsxs)(s.span,{className:"katex-html","aria-hidden":"true",children:[(0,r.jsxs)(s.span,{className:"base",children:[(0,r.jsx)(s.span,{className:"strut",style:{height:"0.8333em",verticalAlign:"-0.15em"}}),(0,r.jsxs)(s.span,{className:"mord",children:[(0,r.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.22222em"},children:"V"}),(0,r.jsx)(s.span,{className:"msupsub",children:(0,r.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,r.jsxs)(s.span,{className:"vlist-r",children:[(0,r.jsx)(s.span,{className:"vlist",style:{height:"0.3361em"},children:(0,r.jsxs)(s.span,{style:{top:"-2.55em",marginLeft:"-0.2222em",marginRight:"0.05em"},children:[(0,r.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,r.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,r.jsx)(s.span,{className:"mord mtight",children:(0,r.jsx)(s.span,{className:"mord text mtight",children:(0,r.jsx)(s.span,{className:"mord mtight",children:"filtered"})})})})]})}),(0,r.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,r.jsx)(s.span,{className:"vlist-r",children:(0,r.jsx)(s.span,{className:"vlist",style:{height:"0.15em"},children:(0,r.jsx)(s.span,{})})})]})})]}),(0,r.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,r.jsx)(s.span,{className:"mrel",children:"="}),(0,r.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,r.jsxs)(s.span,{className:"base",children:[(0,r.jsx)(s.span,{className:"strut",style:{height:"0.4445em"}}),(0,r.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.0037em"},children:"\u03b1"}),(0,r.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,r.jsx)(s.span,{className:"mbin",children:"\u22c5"}),(0,r.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,r.jsxs)(s.span,{className:"base",children:[(0,r.jsx)(s.span,{className:"strut",style:{height:"0.8333em",verticalAlign:"-0.15em"}}),(0,r.jsxs)(s.span,{className:"mord",children:[(0,r.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.22222em"},children:"V"}),(0,r.jsx)(s.span,{className:"msupsub",children:(0,r.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,r.jsxs)(s.span,{className:"vlist-r",children:[(0,r.jsx)(s.span,{className:"vlist",style:{height:"0.1514em"},children:(0,r.jsxs)(s.span,{style:{top:"-2.55em",marginLeft:"-0.2222em",marginRight:"0.05em"},children:[(0,r.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,r.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,r.jsx)(s.span,{className:"mord mtight",children:(0,r.jsx)(s.span,{className:"mord text mtight",children:(0,r.jsx)(s.span,{className:"mord mtight",children:"raw"})})})})]})}),(0,r.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,r.jsx)(s.span,{className:"vlist-r",children:(0,r.jsx)(s.span,{className:"vlist",style:{height:"0.15em"},children:(0,r.jsx)(s.span,{})})})]})})]}),(0,r.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,r.jsx)(s.span,{className:"mbin",children:"+"}),(0,r.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,r.jsxs)(s.span,{className:"base",children:[(0,r.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,r.jsx)(s.span,{className:"mopen",children:"("}),(0,r.jsx)(s.span,{className:"mord",children:"1"}),(0,r.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,r.jsx)(s.span,{className:"mbin",children:"\u2212"}),(0,r.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,r.jsxs)(s.span,{className:"base",children:[(0,r.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,r.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.0037em"},children:"\u03b1"}),(0,r.jsx)(s.span,{className:"mclose",children:")"}),(0,r.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,r.jsx)(s.span,{className:"mbin",children:"\u22c5"}),(0,r.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,r.jsxs)(s.span,{className:"base",children:[(0,r.jsx)(s.span,{className:"strut",style:{height:"0.8333em",verticalAlign:"-0.15em"}}),(0,r.jsxs)(s.span,{className:"mord",children:[(0,r.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.22222em"},children:"V"}),(0,r.jsx)(s.span,{className:"msupsub",children:(0,r.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,r.jsxs)(s.span,{className:"vlist-r",children:[(0,r.jsx)(s.span,{className:"vlist",style:{height:"0.3361em"},children:(0,r.jsxs)(s.span,{style:{top:"-2.55em",marginLeft:"-0.2222em",marginRight:"0.05em"},children:[(0,r.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,r.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,r.jsx)(s.span,{className:"mord mtight",children:(0,r.jsx)(s.span,{className:"mord text mtight",children:(0,r.jsx)(s.span,{className:"mord mtight",children:"filtered"})})})})]})}),(0,r.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,r.jsx)(s.span,{className:"vlist-r",children:(0,r.jsx)(s.span,{className:"vlist",style:{height:"0.15em"},children:(0,r.jsx)(s.span,{})})})]})})]})]})]})]})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Parameters (tuned empirically):"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsxs)(s.span,{className:"katex",children:[(0,r.jsx)(s.span,{className:"katex-mathml",children:(0,r.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,r.jsxs)(s.semantics,{children:[(0,r.jsxs)(s.mrow,{children:[(0,r.jsx)(s.mi,{children:"\u03b1"}),(0,r.jsx)(s.mo,{children:"="}),(0,r.jsx)(s.mn,{children:"0.15"})]}),(0,r.jsx)(s.annotation,{encoding:"application/x-tex",children:"\\alpha = 0.15"})]})})}),(0,r.jsxs)(s.span,{className:"katex-html","aria-hidden":"true",children:[(0,r.jsxs)(s.span,{className:"base",children:[(0,r.jsx)(s.span,{className:"strut",style:{height:"0.4306em"}}),(0,r.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.0037em"},children:"\u03b1"}),(0,r.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,r.jsx)(s.span,{className:"mrel",children:"="}),(0,r.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,r.jsxs)(s.span,{className:"base",children:[(0,r.jsx)(s.span,{className:"strut",style:{height:"0.6444em"}}),(0,r.jsx)(s.span,{className:"mord",children:"0.15"})]})]})]})," (faster response)"]}),"\n",(0,r.jsx)(s.li,{children:"Threshold = 40 LSB (aggressive filtering)"}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Why this exists as a class:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Encapsulates filter state"}),"\n",(0,r.jsx)(s.li,{children:"Allows multiple independent pots"}),"\n",(0,r.jsx)(s.li,{children:"Demonstrates basic OOP without overcomplicating"}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"What it does NOT do:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"\u274c Polymorphism"}),"\n",(0,r.jsx)(s.li,{children:"\u274c Inheritance"}),"\n",(0,r.jsx)(s.li,{children:"\u274c Abstract interfaces"}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"6-state-management",children:"6. State Management"}),"\n",(0,r.jsx)(s.h3,{id:"61-ui-state-machine",children:"6.1 UI State Machine"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-cpp",children:"enum UIState { STATE_PLAYING, STATE_MENU };\r\nUIState currentUIState = STATE_MENU;\n"})}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"State"}),(0,r.jsx)(s.th,{children:"Trigger"}),(0,r.jsx)(s.th,{children:"Display"}),(0,r.jsx)(s.th,{children:"Encoder Behavior"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"STATE_MENU"})}),(0,r.jsx)(s.td,{children:"Boot / Encoder turn"}),(0,r.jsx)(s.td,{children:"Mode selection screen"}),(0,r.jsx)(s.td,{children:"Scroll through waveforms"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"STATE_PLAYING"})}),(0,r.jsx)(s.td,{children:"Button press / Timeout"}),(0,r.jsx)(s.td,{children:"Live frequency display"}),(0,r.jsx)(s.td,{children:"(Not used in v3.8)"})]})]})]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Timeout behavior:"})," After 10 seconds of inactivity in MENU, auto-return to PLAYING"]}),"\n",(0,r.jsx)(s.h3,{id:"62-mute-state",children:"6.2 Mute State"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-cpp",children:"bool isMuted = true;  // Starts muted on boot\n"})}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Toggle:"})," Long press (800ms) on encoder button"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Safety:"})," System ALWAYS boots muted to prevent audio surprises"]}),"\n",(0,r.jsx)(s.h3,{id:"63-waveform-modes",children:"6.3 Waveform Modes"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-cpp",children:'const char* menuItems[] = {"SQUARE", "SAW", "TRIANGLE", "NOISE"};\r\nint selectedMode = -1;  // -1 = no mode selected yet\n'})}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Mode"}),(0,r.jsx)(s.th,{children:"Implementation"}),(0,r.jsx)(s.th,{children:"Duty Cycle Behavior"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"0: Square"}),(0,r.jsx)(s.td,{children:"Fixed 50% duty"}),(0,r.jsx)(s.td,{children:"Pot2 controls duty (square \u2192 pulse)"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"1: Saw"}),(0,r.jsx)(s.td,{children:"Variable duty"}),(0,r.jsx)(s.td,{children:"Pot2 sweeps 0-100%"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"2: Triangle"}),(0,r.jsx)(s.td,{children:"Variable duty"}),(0,r.jsx)(s.td,{children:"Triangle-like waveform using PWM duty sweep (not mathematically linear)"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"3: Noise"}),(0,r.jsx)(s.td,{children:"Randomized freq + duty"}),(0,r.jsx)(s.td,{children:"Pot1 controls noise ceiling"})]})]})]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Note:"})," These are PWM duty cycle approximations, not true waveform synthesis."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"7-interrupt-service-routine-isr",children:"7. Interrupt Service Routine (ISR)"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-cpp",children:"void IRAM_ATTR updateEncoder() {\r\n  unsigned long interruptTime = millis();\r\n  \r\n  // Debounce: 10ms lockout\r\n  if (interruptTime - lastInterruptTime > 10) {\r\n    if (digitalRead(PIN_CLK) != digitalRead(PIN_DT)) {\r\n      virtualPosition++;\r\n    } else {\r\n      virtualPosition--;\r\n    }\r\n    lastInterruptTime = interruptTime;\r\n  }\r\n}\n"})}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Attached to:"})," ",(0,r.jsx)(s.code,{children:"PIN_DT"})," falling edge",(0,r.jsx)(s.br,{}),"\n",(0,r.jsx)(s.strong,{children:"Priority:"})," Hardware interrupt (highest)",(0,r.jsx)(s.br,{}),"\n",(0,r.jsx)(s.strong,{children:"Critical section:"})," Reads ",(0,r.jsx)(s.code,{children:"virtualPosition"})," protected with ",(0,r.jsx)(s.code,{children:"noInterrupts()"})," / ",(0,r.jsx)(s.code,{children:"interrupts()"})]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Why IRAM_ATTR?"})}),"\n",(0,r.jsx)(s.p,{children:"ESP32-specific: Ensures the ISR resides in instruction RAM, avoiding flash/cache dependency during interrupt execution."}),"\n",(0,r.jsxs)(s.admonition,{title:"Implementation Note",type:"caution",children:[(0,r.jsxs)(s.p,{children:["Using ",(0,r.jsx)(s.code,{children:"millis()"})," inside an ISR is not ideal practice, but is acceptable here due to:"]}),(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Human-driven interrupt source"}),"\n",(0,r.jsx)(s.li,{children:"Typical interrupt rates in the tens to hundreds per second during rotation"}),"\n",(0,r.jsx)(s.li,{children:"No strict timing requirements"}),"\n"]}),(0,r.jsx)(s.p,{children:"This will be refactored to use hardware timer counters in v4.0."})]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"8-main-loop-structure",children:"8. Main Loop Structure"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-cpp",children:"void loop() {\r\n  // A. Button handling (short/long press detection)\r\n  // B. Encoder position read (atomic access)\r\n  // C. UI state transitions\r\n  // D. Display update (capped at 20 FPS)\r\n  // E. Potentiometer filtering\r\n  // F. Audio engine (PWM control)\r\n}\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Loop characteristics:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Frequency: ~7.6 kHz (measured under typical load) ",(0,r.jsx)(s.code,{children:"[MEASURED]"})]}),"\n",(0,r.jsx)(s.li,{children:"Display refresh: 20 FPS (50ms interval cap)"}),"\n",(0,r.jsxs)(s.li,{children:["Audio update:","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"On potentiometer change (normal modes)"}),"\n",(0,r.jsx)(s.li,{children:"Continuous random update (NOISE mode)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"9-timing-model",children:"9. Timing Model"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Critical understanding:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Audio output is ",(0,r.jsx)(s.strong,{children:"NOT sample-accurate"})]}),"\n",(0,r.jsxs)(s.li,{children:["PWM frequency updates are ",(0,r.jsx)(s.strong,{children:"event-driven"}),", not clock-driven"]}),"\n",(0,r.jsx)(s.li,{children:"No fixed sample clock exists in v3.8"}),"\n",(0,r.jsx)(s.li,{children:"Timing jitter is visible on oscilloscope measurements"}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Why this matters:"})}),"\n",(0,r.jsx)(s.p,{children:"This limitation directly motivated the v4.0 I2S refactor."}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Aspect"}),(0,r.jsx)(s.th,{children:"PWM (v3.8)"}),(0,r.jsx)(s.th,{children:"DAC (v4.0 planned)"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Timing"}),(0,r.jsx)(s.td,{children:"Event-based"}),(0,r.jsx)(s.td,{children:"Sample-clocked (target)"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Jitter"}),(0,r.jsx)(s.td,{children:"High (visible)"}),(0,r.jsx)(s.td,{children:"Low (target)"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Filtering"}),(0,r.jsx)(s.td,{children:"External RC"}),(0,r.jsx)(s.td,{children:"Digital reconstruction"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Audio Quality"}),(0,r.jsx)(s.td,{children:"Lo-Fi (~8-bit)"}),(0,r.jsx)(s.td,{children:"Hi-Fi (16-bit target)"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Sample Rate"}),(0,r.jsx)(s.td,{children:"Variable"}),(0,r.jsx)(s.td,{children:"Fixed 44.1 kHz (target)"})]})]})]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"10-audio-engine-pwm-generation",children:"10. Audio Engine (PWM Generation)"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-cpp",children:"if (!isMuted && selectedMode != -1) {\r\n  if (selectedMode == 3) {\r\n    // NOISE mode\r\n    int noiseFreq = random(200, noiseCeiling);\r\n    int noiseDuty = random(10, 255);\r\n    ledcChangeFrequency(LEDC_CHANNEL, noiseFreq, LEDC_RESOLUTION);\r\n    ledcWrite(LEDC_CHANNEL, noiseDuty);\r\n  } else {\r\n    // Normal modes\r\n    int targetFrequency = map(potPitch.getValue(), 0, 4095, 350, 2000);\r\n    int targetDuty = map(potTone.getValue(), 0, 4095, 0, 255);\r\n    \r\n    ledcChangeFrequency(LEDC_CHANNEL, targetFrequency, LEDC_RESOLUTION);\r\n    ledcWrite(LEDC_CHANNEL, targetDuty);\r\n  }\r\n}\n"})}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Critical bug fix:"})," Order matters!"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-cpp",children:"\u274c WRONG: ledcWrite() then ledcChangeFrequency()\r\n\u2705 CORRECT: ledcChangeFrequency() then ledcWrite()\n"})}),"\n",(0,r.jsxs)(s.p,{children:["Using ",(0,r.jsx)(s.code,{children:"ledcWriteTone()"})," corrupts duty cycle settings.",(0,r.jsx)(s.br,{}),"\n","This was discovered via oscilloscope debugging."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"11-display-rendering",children:"11. Display Rendering"}),"\n",(0,r.jsxs)(s.p,{children:["All graphics are ",(0,r.jsx)(s.strong,{children:"procedurally generated"})," \u2014 no bitmaps stored."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-cpp",children:"void drawWaveIcon(int mode, int x, int y) {\r\n  switch(mode) {\r\n    case 0: /* Draw square wave lines */\r\n    case 1: /* Draw sawtooth lines */\r\n    case 2: /* Draw triangle lines */\r\n    case 3: /* Draw noise pattern */\r\n  }\r\n}\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Why procedural?"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Minimal memory footprint"}),"\n",(0,r.jsx)(s.li,{children:"Scalable graphics"}),"\n",(0,r.jsx)(s.li,{children:"Educational: understanding pixel-level drawing"}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Display buffer:"})," 128\xd732 monochrome (512 bytes total)"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"12-code-annotations",children:"12. Code Annotations"}),"\n",(0,r.jsx)(s.h3,{id:"button-state-machine",children:"Button State Machine"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-cpp",children:"// Short press: Select mode\r\n// Long press (>800ms): Toggle mute\r\nif (reading == LOW && !buttonActive) {\r\n  buttonActive = true;\r\n  pressStartTime = millis();\r\n  longPressHandled = false;\r\n}\n"})}),"\n",(0,r.jsx)(s.h3,{id:"race-condition-protection",children:"Race Condition Protection"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-cpp",children:"int currentPos;\r\nnoInterrupts();                    // Enter critical section\r\ncurrentPos = virtualPosition;      // Read ISR variable safely\r\ninterrupts();                      // Exit critical section\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Why this is necessary:"})}),"\n",(0,r.jsxs)(s.p,{children:["Without atomic access, the main loop could read ",(0,r.jsx)(s.code,{children:"virtualPosition"})," while the ISR is writing to it."]}),"\n",(0,r.jsx)(s.h3,{id:"display-throttling",children:"Display Throttling"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-cpp",children:"if (millis() - lastDisplayUpdate > 50) {  // 20 FPS cap\r\n  updateDisplay();\r\n  lastDisplayUpdate = millis();\r\n}\n"})}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Prevents:"})," I2C bus saturation and audio timing interference"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"13-known-software-issues",children:"13. Known Software Issues"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Issue"}),(0,r.jsx)(s.th,{children:"Cause"}),(0,r.jsx)(s.th,{children:"Impact"}),(0,r.jsx)(s.th,{children:"Planned Fix"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Pitch quantization"}),(0,r.jsx)(s.td,{children:"Hysteresis threshold too high"}),(0,r.jsx)(s.td,{children:"~15 Hz steps"}),(0,r.jsx)(s.td,{children:"Tune threshold or move to DAC"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"No boot animation"}),(0,r.jsx)(s.td,{children:"Immediate start"}),(0,r.jsx)(s.td,{children:"User confusion"}),(0,r.jsx)(s.td,{children:"Add splash screen"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Encoder false steps"}),(0,r.jsx)(s.td,{children:"HW quality + SW debounce"}),(0,r.jsx)(s.td,{children:"Occasional skips"}),(0,r.jsx)(s.td,{children:"Better encoder hardware"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Frequency jumps"}),(0,r.jsx)(s.td,{children:"Race condition (rare)"}),(0,r.jsx)(s.td,{children:"Audio glitch"}),(0,r.jsx)(s.td,{children:"Atomic flag protection"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsxs)(s.td,{children:[(0,r.jsx)(s.code,{children:"millis()"})," in ISR"]}),(0,r.jsx)(s.td,{children:"Overhead inside interrupt"}),(0,r.jsx)(s.td,{children:"None observable"}),(0,r.jsx)(s.td,{children:"Hardware timer in v4.0"})]})]})]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"14-whats-not-here",children:"14. What's NOT Here"}),"\n",(0,r.jsxs)(s.p,{children:["To be explicit, v3.8 does ",(0,r.jsx)(s.strong,{children:"not"})," include:"]}),"\n",(0,r.jsx)(s.h3,{id:"architecture",children:"Architecture"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"\u274c Object-oriented design"}),"\n",(0,r.jsx)(s.li,{children:"\u274c Class hierarchies"}),"\n",(0,r.jsx)(s.li,{children:"\u274c Polymorphism"}),"\n",(0,r.jsx)(s.li,{children:"\u274c Hardware abstraction layer (HAL)"}),"\n",(0,r.jsx)(s.li,{children:"\u274c Multiple source files"}),"\n",(0,r.jsx)(s.li,{children:"\u274c RTOS or threading"}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"audio",children:"Audio"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"\u274c True waveform synthesis"}),"\n",(0,r.jsx)(s.li,{children:"\u274c I2S protocol"}),"\n",(0,r.jsx)(s.li,{children:"\u274c DAC output"}),"\n",(0,r.jsx)(s.li,{children:"\u274c ADSR envelopes"}),"\n",(0,r.jsx)(s.li,{children:"\u274c Digital filters (LPF/HPF/BPF)"}),"\n",(0,r.jsx)(s.li,{children:"\u274c Polyphony"}),"\n",(0,r.jsx)(s.li,{children:"\u274c Look-up tables"}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"optimization",children:"Optimization"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"\u274c Dual-core usage"}),"\n",(0,r.jsx)(s.li,{children:"\u274c DMA transfers"}),"\n",(0,r.jsx)(s.li,{children:"\u274c Fixed-point arithmetic"}),"\n",(0,r.jsx)(s.li,{children:"\u274c Sample-accurate timing"}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"These will be introduced gradually starting in v4.0."}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"15-what-this-architecture-taught-me",children:"15. What This Architecture Taught Me"}),"\n",(0,r.jsx)(s.p,{children:"Beyond the technical implementation:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Abstractions hide timing problems"})," \u2014 PWM exposed audio physics brutally"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Global state is dangerous but educational"})," \u2014 Race conditions become visible"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Simplicity accelerates understanding"})," \u2014 No layers to debug through"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Debugging with a scope beats guessing"})," \u2014 Visual feedback is irreplaceable"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Order matters in embedded systems"})," \u2014 Function call sequence affects hardware behavior"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"These lessons inform the v4.0 refactor."}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"16-next-v40-software-refactor",children:"16. Next: v4.0 Software Refactor"}),"\n",(0,r.jsxs)(s.p,{children:["The next iteration focuses on ",(0,r.jsx)(s.strong,{children:"modularity and proper audio"}),", not features."]}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Aspect"}),(0,r.jsx)(s.th,{children:"v3.8"}),(0,r.jsx)(s.th,{children:"v4.0"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Files"}),(0,r.jsx)(s.td,{children:"1"}),(0,r.jsx)(s.td,{children:"6+"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Classes"}),(0,r.jsx)(s.td,{children:"1"}),(0,r.jsx)(s.td,{children:"5+"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Architecture"}),(0,r.jsx)(s.td,{children:"Procedural"}),(0,r.jsx)(s.td,{children:"OOP with HAL"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Audio"}),(0,r.jsx)(s.td,{children:"PWM direct"}),(0,r.jsx)(s.td,{children:"I2S abstraction"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Waveforms"}),(0,r.jsx)(s.td,{children:"Duty cycle tricks"}),(0,r.jsx)(s.td,{children:"True DDS synthesis"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Threading"}),(0,r.jsx)(s.td,{children:"Single-threaded"}),(0,r.jsx)(s.td,{children:"Possible dual-core usage (planned)"})]})]})]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Goal:"})," Separate concerns without losing transparency."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"17-related-documentation",children:"17. Related Documentation"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"./hardware-design",children:"Hardware Design"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"./build-guide",children:"Build Guide"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"https://github.com/MatiDashkov07/portfolio_eduLAB/blob/main/src/main.cpp",children:"Full Source Code"})}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"closing",children:"Closing"}),"\n",(0,r.jsx)(s.p,{children:"This software architecture is not impressive by professional standards."}),"\n",(0,r.jsx)(s.p,{children:"Its value lies in the embedded systems lessons it exposes."}),"\n",(0,r.jsx)(s.p,{children:"Every limitation is intentional. Every choice is documented."}),"\n",(0,r.jsxs)(s.p,{children:["The refactor to OOP will happen ",(0,r.jsx)(s.strong,{children:"after"})," the fundamentals are understood."]})]})}function o(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}}}]);